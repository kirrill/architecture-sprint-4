# Архитектурное решение по логированию
## Список логов с уровнем INFO
* Изменение статуса заказа (идентификатор заказа, текущее время, идентификатор пользователя изменившего статус) - в системах Shop API, CRM API, MES API. 
* Вход пользователя в систему (идентификатор пользователя, текущее время) - в системах Shop API, CRM API, MES API.

## Мотивация

Логи это основной инструмент для поиска истоничника проблем в ПО, т.к.:
* позволяют отладить и проанализировать работу системы без "влезания" в код, т.е. для первичной "отладки" можно не привлекать программиста, что снижает расходы на поддержку
* являются источником данных для мониторинга

Логирование и трейсинг в первую очередь необходимо насроить для самых проблемных систем, в данном случае это MES, MES API и возможно CRM API

## Предлагаемое решение

Для реализации логирования в первую очередь необходимо будет добавить механизм логирования в исходный код систем, для этого можно будет либо воспользоаться какой-нибудь готовой библиотекой для C# и Java SpringBoot, либо выполнить собственную реализацию логирования.
Далее можно использовать инструменты из стека ELK для сбора, хранения и анализа. 

Целевая архитектура представлена на схеме
[Ссылка на C4 диаграмму с логированием](logging.drawio)


## Безопасность

Доступ к логам, которые могут содержать чувствительные данные должен регулироваться наличием специальной роли, у сотрудника команды поддержки

## Хранение логов

Для каждой системы логи будут храниться в отдельном индексе.
Срок хранения логов работы сервиса - две недели
Срок хранения логов безопасности (входов пользователей) - 3 месяца. 


## Система анализа логов

Для превращения системы сбора логов в систему анализа логов необходимо настроить алертинг для ситуаций требуюших вмешательства, например:
* когда закачнивается место на серверах БД и S3
* когда загрузка CPU/RAM загружена на 100% более n-минут
* при найденной аномалии (кратно увеличилось среднее кол-во запросов в секунду)
Настройку алертинга можно произвести в Grafana
